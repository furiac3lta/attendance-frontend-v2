import{a as m}from"./chunk-QJGRYSSM.js";import{c as u}from"./chunk-5JTNXZA4.js";import{a as c}from"./chunk-FOSQZ4YM.js";import{Ac as l,U as s,Y as n,aa as a,e as p,m as i}from"./chunk-EKT4D7I2.js";var r=p(m());var g=class o{constructor(t,e){this.http=t;this.router=e}base=`${c.API_URL}/auth`;roleSubject=new i(sessionStorage.getItem("role"));loginStatus=new i(this.hasToken());loginStatus$=this.loginStatus.asObservable();role$=this.roleSubject.asObservable();hasToken(){return!!localStorage.getItem("token")}login(t){return this.http.post(`${this.base}/login`,t).pipe(s({next:e=>{if(e&&e.token)switch(localStorage.setItem("token",e.token),localStorage.setItem("role",e.type),e.user&&localStorage.setItem("user",JSON.stringify(e.user)),this.loginStatus.next(!0),e.type?.replace(/^ROLE_/,"").toUpperCase()){case"SUPER_ADMIN":this.router.navigate(["/organizations"]);break;case"ADMIN":this.router.navigate(["/users"]);break;case"INSTRUCTOR":this.router.navigate(["/attendance"]);break;case"USER":this.router.navigate(["/courses"]);break;default:r.default.fire({title:"Error",text:"Rol no reconocido. Contact\xE1 al administrador.",icon:"error",heightAuto:!1}),this.logout();break}else r.default.fire({title:"Error",text:"No se recibi\xF3 token desde el servidor.",icon:"error",heightAuto:!1})},error:e=>{e.status===403?r.default.fire({title:"Acceso denegado",text:"Tu cuenta no tiene permisos para ingresar.",icon:"error",heightAuto:!1}):e.status===401?r.default.fire({title:"Credenciales incorrectas",text:"Revis\xE1 tu email y contrase\xF1a.",icon:"warning",heightAuto:!1}):r.default.fire({title:"Error de servidor",text:"No se pudo conectar. Intent\xE1 nuevamente.",icon:"error",heightAuto:!1})}}))}register(t){return this.http.post(`${this.base}/register`,t)}logout(){localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("user"),this.loginStatus.next(!1),this.roleSubject.next(null),this.router.navigate(["/login"]),r.default.fire({title:"Sesi\xF3n cerrada",text:"Has salido correctamente.",icon:"info",heightAuto:!1})}getToken(){return localStorage.getItem("token")}isLoggedIn(){return!!localStorage.getItem("token")}getRole(){let t=localStorage.getItem("role");return t?t.replace(/^ROLE_/,"").toUpperCase():""}getUser(){let t=localStorage.getItem("user");return t?JSON.parse(t):null}static \u0275fac=function(e){return new(e||o)(a(l),a(u))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{g as a};
