import{a as U}from"./chunk-25CNMZSN.js";import{b as G,d as K,e as Q}from"./chunk-PWXAEPG7.js";import{a as Z}from"./chunk-QJGRYSSM.js";import{a as k}from"./chunk-WOQCSS36.js";import"./chunk-A3HJGCKZ.js";import{r as T}from"./chunk-RLT3B664.js";import{a as F,b as $,c as H,d as V,e as Y,f as J,g as j,h as z,i as L,j as B,k as q}from"./chunk-GV56X2P2.js";import"./chunk-XODYYG4P.js";import{a as I}from"./chunk-5JTNXZA4.js";import"./chunk-FOSQZ4YM.js";import{a as A,b as N}from"./chunk-4TOFOFSS.js";import{Ca as l,Db as y,Gb as a,Ib as m,Jb as P,Ka as f,Qa as w,Qb as S,Sb as R,Ua as p,e as X,fa as g,fb as c,ga as C,gb as o,hb as n,ib as b,mb as s,nb as d,pb as x,pc as E,rb as v,sb as u,uc as O,vc as D}from"./chunk-EKT4D7I2.js";var M=X(Z());function ee(i,e){if(i&1){let t=x();o(0,"mat-chip-option",22),v("click",function(){let h=g(t).$implicit,_=u();return C(_.setMonth(h.value))}),a(1),n()}if(i&2){let t=e.$implicit,r=u();c("selected",r.month===t.value),l(),m(" ",t.short," ")}}function te(i,e){if(i&1){let t=x();o(0,"mat-chip-option",22),v("click",function(){let h=g(t).$implicit,_=u();return C(_.setYear(h))}),a(1),n()}if(i&2){let t=e.$implicit,r=u();c("selected",r.year===t),l(),m(" ",t," ")}}function ie(i,e){i&1&&(o(0,"th",23),a(1," Alumno "),n())}function oe(i,e){if(i&1&&(o(0,"td",24),a(1),n()),i&2){let t=e.$implicit;l(),m(" ",t.studentName," ")}}function ne(i,e){i&1&&(o(0,"th",23),a(1," Asistencias "),n())}function re(i,e){if(i&1&&(o(0,"td",24),a(1),n()),i&2){let t=e.$implicit;l(),m(" ",t.present," ")}}function ae(i,e){i&1&&(o(0,"th",23),a(1," Faltas "),n())}function le(i,e){if(i&1&&(o(0,"td",24),a(1),n()),i&2){let t=e.$implicit;l(),m(" ",t.absent," ")}}function pe(i,e){i&1&&(o(0,"th",23),a(1," Total "),n())}function me(i,e){if(i&1&&(o(0,"td",24),a(1),n()),i&2){let t=e.$implicit;l(),m(" ",t.total," ")}}function ce(i,e){i&1&&(o(0,"th",23),a(1," % "),n())}function se(i,e){if(i&1&&(o(0,"td",24)(1,"span"),a(2),S(3,"number"),n()()),i&2){let t=e.$implicit,r=u();l(),y("color",r.getColor(t.percent)),l(),m(" ",R(3,3,t.percent,"1.0-1"),"% ")}}function de(i,e){i&1&&b(0,"tr",25)}function ue(i,e){i&1&&b(0,"tr",26)}var W=class i{constructor(e,t,r){this.route=e;this.attendanceSvc=t;this.courseSvc=r}displayedColumns=["studentName","present","absent","total","percent"];courseId;month;year;courseName="";stats=[];months=[{value:1,label:"Enero",short:"Ene"},{value:2,label:"Febrero",short:"Feb"},{value:3,label:"Marzo",short:"Mar"},{value:4,label:"Abril",short:"Abr"},{value:5,label:"Mayo",short:"May"},{value:6,label:"Junio",short:"Jun"},{value:7,label:"Julio",short:"Jul"},{value:8,label:"Agosto",short:"Ago"},{value:9,label:"Septiembre",short:"Sep"},{value:10,label:"Octubre",short:"Oct"},{value:11,label:"Noviembre",short:"Nov"},{value:12,label:"Diciembre",short:"Dic"}];years=[];ngOnInit(){this.courseId=Number(this.route.snapshot.paramMap.get("courseId"));let e=new Date;this.month=e.getMonth()+1,this.year=e.getFullYear();let t=e.getFullYear();this.years=Array.from({length:6},(r,h)=>t-h),this.loadCourseInfo(),this.loadReport()}setMonth(e){this.month=e,this.loadReport()}setYear(e){this.year=e,this.loadReport()}loadCourseInfo(){this.courseSvc.getById(this.courseId).subscribe({next:e=>this.courseName=e.name,error:()=>{this.courseName="Curso desconocido",M.default.fire({icon:"warning",title:"Atenci\xF3n",text:"No se pudo cargar el nombre del curso.",heightAuto:!1})}})}loadReport(){this.attendanceSvc.getMonthlyReport(this.courseId,this.month,this.year).subscribe({next:e=>{this.stats=e.map(t=>({studentName:t.studentName,present:t.present??0,total:t.totalClasses??t.total??0,absent:(t.totalClasses??t.total??0)-(t.present??0),percent:t.percent??0}))},error:()=>{M.default.fire({icon:"error",title:"Error",text:"No se pudo cargar el reporte mensual.",heightAuto:!1})}})}getMonthLabel(e){return this.months.find(t=>t.value===e)?.label??""}getColor(e){return e>=85?"limegreen":e>=60?"orange":"red"}static \u0275fac=function(t){return new(t||i)(f(I),f(U),f(k))};static \u0275cmp=w({type:i,selectors:[["app-course-report"]],decls:38,vars:8,consts:[[1,"page-card"],[1,"title"],[1,"chips-container"],[1,"chip-section"],[1,"chip-title"],["aria-label","Meses",1,"chip-list"],[3,"selected","click",4,"ngFor","ngForOf"],["aria-label","A\xF1os",1,"chip-list"],[1,"report-section"],[1,"table-scroll-wrapper"],[1,"table-section"],[1,"subtitle"],["mat-table","",1,"table-modern","responsive-table",3,"dataSource"],["matColumnDef","studentName"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","present"],["matColumnDef","absent"],["matColumnDef","total"],["matColumnDef","percent"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"click","selected"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(o(0,"mat-card",0)(1,"h2",1),a(2),n(),o(3,"div",2)(4,"div",3)(5,"p",4),a(6,"Mes"),n(),o(7,"mat-chip-listbox",5),p(8,ee,2,2,"mat-chip-option",6),n()(),o(9,"div",3)(10,"p",4),a(11,"A\xF1o"),n(),o(12,"mat-chip-listbox",7),p(13,te,2,2,"mat-chip-option",6),n()()(),o(14,"div",8)(15,"div",9)(16,"div",10)(17,"h3",11),a(18),n(),o(19,"div",9)(20,"table",12),s(21,13),p(22,ie,2,0,"th",14)(23,oe,2,1,"td",15),d(),s(24,16),p(25,ne,2,0,"th",14)(26,re,2,1,"td",15),d(),s(27,17),p(28,ae,2,0,"th",14)(29,le,2,1,"td",15),d(),s(30,18),p(31,pe,2,0,"th",14)(32,me,2,1,"td",15),d(),s(33,19),p(34,ce,2,0,"th",14)(35,se,4,6,"td",15),d(),p(36,de,1,0,"tr",20)(37,ue,1,0,"tr",21),n()()()()()()),t&2&&(l(2),m("Reporte mensual - ",r.courseName),l(6),c("ngForOf",r.months),l(5),c("ngForOf",r.years),l(5),P(" ",r.getMonthLabel(r.month)," ",r.year," "),l(2),c("dataSource",r.stats),l(16),c("matHeaderRowDef",r.displayedColumns),l(),c("matRowDefColumns",r.displayedColumns))},dependencies:[D,E,T,N,A,q,F,H,j,V,$,z,Y,J,L,B,Q,K,G,O],styles:[".chips-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:14px;margin-bottom:20px}.chip-section[_ngcontent-%COMP%]{flex:1;min-width:140px}.chip-title[_ngcontent-%COMP%]{font-size:14px;margin-bottom:6px;font-weight:600}.chip-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px}  mat-chip-option .mdc-evolution-chip__cell{background:#e6e6e6a6!important;border-radius:14px!important;border:1px solid rgba(0,0,0,.1)!important;padding:2px px!important;color:var(--text-strong)!important;font-size:.82rem!important;font-weight:500;transition:.25s ease}  mat-chip-option:hover .mdc-evolution-chip__cell{background:#c8c8c88c!important}  mat-chip-option.mat-mdc-chip-selected .mdc-evolution-chip__cell{background:var(--accent-strong)!important;border-color:var(--accent-hover)!important;color:#000!important;box-shadow:0 0 8px #ffafcc73}  mat-chip-option .mdc-evolution-chip__action{color:inherit!important}  .dark-mode mat-chip-option .mdc-evolution-chip__cell{background:#ffffff1f!important;border-color:#ffffff40!important;color:var(--text)!important}  .dark-mode mat-chip-option:hover .mdc-evolution-chip__cell{background:#fff3!important}  .dark-mode mat-chip-option.mat-mdc-chip-selected .mdc-evolution-chip__cell{background:var(--accent-hover)!important;border-color:var(--accent-strong)!important;color:#000!important;box-shadow:0 0 10px #bde0fea6}.page-card[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:20px}.filters[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px}.table-scroll-wrapper[_ngcontent-%COMP%]{width:100%;overflow-x:auto;overflow-y:hidden;border-radius:10px;margin-top:10px}table[_ngcontent-%COMP%]{width:100%;min-width:600px;border-collapse:collapse}.table-modern[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-modern[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px;text-align:left;white-space:nowrap}.table-modern[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:10px;overflow:hidden}@media (min-width: 600px){.table-modern[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table-modern[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:14px 12px}}"]})};export{W as CourseReportPage};
