import{a as ce}from"./chunk-QJGRYSSM.js";import{a as re}from"./chunk-NOHJCWSU.js";import{a as j}from"./chunk-CMBHYV4C.js";import{l as ie,n as ae,o as oe}from"./chunk-WEUNGTCO.js";import"./chunk-SKV5MVK2.js";import{e as W}from"./chunk-A3HJGCKZ.js";import{f as F,i as H,r as V}from"./chunk-RLT3B664.js";import{a as G,b as q,c as J,d as K,e as Q,f as X,g as Y,h as Z,i as ee,j as te,k as ne}from"./chunk-GV56X2P2.js";import"./chunk-XODYYG4P.js";import{d as D,g as A}from"./chunk-5JTNXZA4.js";import"./chunk-FOSQZ4YM.js";import{a as U}from"./chunk-4TOFOFSS.js";import{a as N,b as R,d as B,e as $,f as k}from"./chunk-V33OWUZQ.js";import{Ca as l,Cb as E,Gb as o,Ib as f,Kb as b,Lb as S,Mb as w,Qa as P,Tb as y,Ua as m,ba as O,e as me,fa as C,fb as c,ga as x,gb as i,hb as a,ib as M,mb as g,nb as p,pb as v,pc as T,qc as L,rb as h,sb as u,vc as I}from"./chunk-EKT4D7I2.js";var s=me(ce());function se(e,t){e&1&&(i(0,"div",20),o(1," No hay organizaciones registradas. "),a())}function de(e,t){e&1&&(i(0,"button",21)(1,"mat-icon"),o(2,"add"),a(),o(3," Nueva Organizaci\xF3n "),a())}function ge(e,t){e&1&&(i(0,"th",22),o(1," Nombre "),a())}function pe(e,t){if(e&1&&(i(0,"td",23),o(1),a()),e&2){let n=t.$implicit;l(),f(" ",n.name," ")}}function _e(e,t){e&1&&(i(0,"th",22),o(1," Tipo "),a())}function ue(e,t){if(e&1&&(i(0,"td",23),o(1),a()),e&2){let n=t.$implicit;l(),f(" ",n.type," ")}}function fe(e,t){e&1&&(i(0,"th",22),o(1," Tel\xE9fono "),a())}function Ce(e,t){if(e&1&&(i(0,"td",23),o(1),a()),e&2){let n=t.$implicit;l(),f(" ",n.phone," ")}}function xe(e,t){e&1&&(i(0,"th",22),o(1," Direcci\xF3n "),a())}function he(e,t){if(e&1&&(i(0,"td",23),o(1),a()),e&2){let n=t.$implicit;l(),f(" ",n.address," ")}}function Oe(e,t){e&1&&(i(0,"th",22),o(1," Admin actual "),a())}function Me(e,t){if(e&1&&(g(0),o(1),p()),e&2){let n=u().$implicit;l(),f(" ",n.adminFullName," ")}}function ve(e,t){e&1&&(i(0,"em",25),o(1,"Sin asignar"),a())}function ze(e,t){if(e&1&&(i(0,"td",23),m(1,Me,2,1,"ng-container",24)(2,ve,2,0,"ng-template",null,0,y),a()),e&2){let n=t.$implicit,r=E(3);l(),c("ngIf",n.adminFullName)("ngIfElse",r)}}function Pe(e,t){e&1&&(i(0,"th",22),o(1," Nuevo Admin "),a())}function Ee(e,t){if(e&1&&(i(0,"mat-option",30),o(1),a()),e&2){let n=t.$implicit;c("value",n.id),l(),f(" ",n.fullName," ")}}function be(e,t){if(e&1){let n=v();i(0,"td",23)(1,"div",27)(2,"mat-form-field",28)(3,"mat-select",29),w("ngModelChange",function(d){let _=C(n).$implicit,z=u(2);return S(z.selectedAdmin[_.id],d)||(z.selectedAdmin[_.id]=d),x(d)}),i(4,"mat-option",30),o(5,"Seleccionar..."),a(),m(6,Ee,2,2,"mat-option",31),a()(),i(7,"button",32),h("click",function(){let d=C(n).$implicit,_=u(2);return x(_.assignAdmin(d.id))}),i(8,"mat-icon",33),o(9,"save"),a()()()()}if(e&2){let n=t.$implicit,r=u(2);l(3),b("ngModel",r.selectedAdmin[n.id]),l(),c("value",null),l(2),c("ngForOf",r.admins),l(),c("disabled",!r.selectedAdmin[n.id])}}function Se(e,t){e&1&&(g(0,26),m(1,Pe,2,0,"th",10)(2,be,10,4,"td",11),p())}function we(e,t){e&1&&(i(0,"th",22),o(1," Acciones "),a())}function ye(e,t){if(e&1){let n=v();i(0,"td",23)(1,"div",27)(2,"button",35),h("click",function(){let d=C(n).$implicit,_=u(2);return x(_.editOrganization(d))}),i(3,"mat-icon",36),o(4,"edit"),a()(),i(5,"button",35),h("click",function(){let d=C(n).$implicit,_=u(2);return x(_.deleteOrganization(d.id))}),i(6,"mat-icon",37),o(7,"delete"),a()()()()}}function Te(e,t){e&1&&(g(0,34),m(1,we,2,0,"th",10)(2,ye,8,0,"td",11),p())}function Le(e,t){e&1&&M(0,"tr",38)}function Ie(e,t){e&1&&M(0,"tr",39)}var le=class e{orgService=O(re);usersService=O(j);organizations=[];admins=[];selectedAdmin={};userRole=sessionStorage.getItem("role");ngOnInit(){this.loadOrganizations(),this.loadAdmins()}loadOrganizations(){this.orgService.findAll().subscribe({next:t=>{this.organizations=t||[]},error:t=>{console.error("\u274C Error al cargar organizaciones:",t),s.default.fire("Error","\u274C No se pudieron cargar las organizaciones","error")}})}loadAdmins(){this.usersService.getUsersByRole("ADMIN").subscribe({next:t=>{this.admins=t},error:()=>s.default.fire("Error","\u274C Error al cargar usuarios administradores","error")})}assignAdmin(t){let n=this.selectedAdmin[t];if(!n){s.default.fire("Atenci\xF3n","\u26A0\uFE0F Seleccion\xE1 un administrador","warning");return}this.orgService.assignAdmin(t,n).subscribe({next:()=>{s.default.fire("\xC9xito","Administrador asignado correctamente","success"),this.loadOrganizations()},error:r=>{console.error("\u274C Error al asignar admin:",r),s.default.fire("Error","\u274C No se pudo asignar el administrador","error")}})}editOrganization(t){s.default.fire({title:"Editar organizaci\xF3n",html:`
        <input id="org-name" class="swal2-input" placeholder="Nombre" value="${t.name}">
        <input id="org-type" class="swal2-input" placeholder="Tipo" value="${t.type}">
        <input id="org-phone" class="swal2-input" placeholder="Tel\xE9fono" value="${t.phone}">
        <input id="org-address" class="swal2-input" placeholder="Direcci\xF3n" value="${t.address}">
      `,showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar",focusConfirm:!1,preConfirm:()=>({name:document.getElementById("org-name").value,type:document.getElementById("org-type").value,phone:document.getElementById("org-phone").value,address:document.getElementById("org-address").value})}).then(n=>{n.isConfirmed&&this.orgService.update(t.id,n.value).subscribe({next:()=>{s.default.fire("Actualizado","La organizaci\xF3n fue editada correctamente","success"),this.loadOrganizations()},error:()=>{s.default.fire("Error","No se pudo actualizar la organizaci\xF3n","error")}})})}deleteOrganization(t){s.default.fire({title:"\xBFEliminar organizaci\xF3n?",text:"Esta acci\xF3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed&&this.orgService.delete(t).subscribe({next:()=>{s.default.fire("Eliminado","Organizaci\xF3n eliminada","success"),this.loadOrganizations()},error:r=>{console.error("\u274C Error al eliminar organizaci\xF3n:",r),s.default.fire("Error","No se pudo eliminar la organizaci\xF3n","error")}})})}displayedColumns=this.userRole==="SUPER_ADMIN"?["name","type","phone","address","admin","selectAdmin","actions"]:["name","type","phone","address","admin"];static \u0275fac=function(n){return new(n||e)};static \u0275cmp=P({type:e,selectors:[["app-organization-list"]],decls:28,vars:7,consts:[["noAdmin",""],[1,"page-card"],[1,"title"],["class","alert alert-info",4,"ngIf"],[1,"actions"],["mat-raised-button","","color","primary","routerLink","/organizations/new",4,"ngIf"],[1,"table-section"],[1,"table-scroll-wrapper"],["mat-table","",1,"table-modern","responsive-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","phone"],["matColumnDef","address"],["matColumnDef","admin"],["matColumnDef","selectAdmin",4,"ngIf"],["matColumnDef","actions",4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"alert","alert-info"],["mat-raised-button","","color","primary","routerLink","/organizations/new"],["mat-header-cell",""],["mat-cell",""],[4,"ngIf","ngIfElse"],[1,"text-muted"],["matColumnDef","selectAdmin"],[1,"actions-inline"],["appearance","outline",1,"admin-select"],["placeholder","Seleccionar...",3,"ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","",3,"click","disabled"],[1,"icon-save"],["matColumnDef","actions"],["mat-icon-button","",3,"click"],[1,"icon-edit"],[1,"icon-delete"],["mat-header-row",""],["mat-row",""]],template:function(n,r){n&1&&(i(0,"mat-card",1)(1,"h2",2),o(2,"Gesti\xF3n de Organizaciones"),a(),m(3,se,2,0,"div",3),i(4,"div",4),m(5,de,4,0,"button",5),a(),i(6,"div",6)(7,"div",7)(8,"table",8),g(9,9),m(10,ge,2,0,"th",10)(11,pe,2,1,"td",11),p(),g(12,12),m(13,_e,2,0,"th",10)(14,ue,2,1,"td",11),p(),g(15,13),m(16,fe,2,0,"th",10)(17,Ce,2,1,"td",11),p(),g(18,14),m(19,xe,2,0,"th",10)(20,he,2,1,"td",11),p(),g(21,15),m(22,Oe,2,0,"th",10)(23,ze,4,2,"td",11),p(),m(24,Se,3,0,"ng-container",16)(25,Te,3,0,"ng-container",17)(26,Le,1,0,"tr",18)(27,Ie,1,0,"tr",19),a()()()()),n&2&&(l(3),c("ngIf",!r.organizations.length),l(2),c("ngIf",r.userRole==="SUPER_ADMIN"),l(3),c("dataSource",r.organizations),l(16),c("ngIf",r.userRole==="SUPER_ADMIN"),l(),c("ngIf",r.userRole==="SUPER_ADMIN"),l(),c("matHeaderRowDef",r.displayedColumns),l(),c("matRowDefColumns",r.displayedColumns))},dependencies:[I,T,L,V,F,H,A,D,ne,G,J,Y,K,q,Z,Q,X,ee,te,oe,W,ae,ie,B,R,N,k,$,U],styles:[".page-card[_ngcontent-%COMP%]{padding:3rem;margin-top:1rem;position:relative;overflow:visible!important}.table-section[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;margin-top:1rem}.table-scroll-wrapper[_ngcontent-%COMP%]{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:thin}.table-modern[_ngcontent-%COMP%]{width:100%;min-width:750px;border-collapse:collapse}.actions[_ngcontent-%COMP%]{margin-bottom:1.5rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-weight:500}.admin-select[_ngcontent-%COMP%]{width:180px}@media (max-width: 768px){.page-card[_ngcontent-%COMP%]{padding:1.4rem}.table-scroll-wrapper[_ngcontent-%COMP%]{max-width:100%;overflow-x:auto;padding-bottom:10px}.table-modern[_ngcontent-%COMP%]{min-width:600px}.actions[_ngcontent-%COMP%]{text-align:center}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}.actions-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.icon-edit[_ngcontent-%COMP%]{color:#ff4db2!important;transition:.2s ease}.icon-edit[_ngcontent-%COMP%]:hover{color:#d9368e!important;transform:scale(1.15)}.icon-delete[_ngcontent-%COMP%]{color:#ff4e4e!important;transition:.2s ease}.icon-delete[_ngcontent-%COMP%]:hover{color:#a23de5!important;transform:scale(1.15)}.icon-save[_ngcontent-%COMP%]{color:#7c3aed!important;transition:.2s ease}.icon-save[_ngcontent-%COMP%]:hover{color:#5b21b6!important;transform:scale(1.15)}.mat-icon[_ngcontent-%COMP%]{font-size:22px!important}button.mat-icon-button[_ngcontent-%COMP%]{padding:4px;min-width:32px;min-height:32px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{vertical-align:middle!important}.text-muted[_ngcontent-%COMP%]{color:#777}.mat-row[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;transition:.2s}"]})};export{le as OrganizationListPage};
