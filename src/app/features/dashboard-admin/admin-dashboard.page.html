<div class="admin-dashboard" *ngIf="proPlan; else freePlanNotice">
  <ng-container *ngIf="data as d">

  <header class="hero">
    <div>
      <h1 class="eyebrow">Hola, {{ organizationName }}</h1>
      <h2>Panel de desempeño</h2    >
      <p class="muted">
        Métricas rápidas para tu organización. Datos actualizados del último corte.
      </p>
    </div>

    <div class="hero-pill">
      <p class="label">Con deuda</p>
      <h3>{{ unpaidPercent }}%</h3>
      <span>{{ d.unpaidStudents }} alumnos de {{ d.activeStudents }}</span>
    </div>
  </header>

  <section class="kpi-grid">
    <article class="kpi-card">
      <div class="kpi-head">
        <mat-icon class="icon primary">groups</mat-icon>
        <span class="badge positive">+2.4%</span>
      </div>
      <p class="label">Alumnos activos</p>
      <h2>{{ d.activeStudents }}</h2>
      <small>Con asistencia vigente</small>
    </article>

    <article class="kpi-card">
      <div class="kpi-head">
        <mat-icon class="icon success">check_circle</mat-icon>
        <span class="badge positive">+5 alumnos</span>
      </div>
      <p class="label">Pagaron</p>
      <h2>{{ d.paidStudents }}</h2>
      <small>Pagos confirmados</small>
    </article>

    <article class="kpi-card">
      <div class="kpi-head">
        <mat-icon class="icon warn">warning</mat-icon>
        <span class="badge negative">-3%</span>
      </div>
      <p class="label">Con deuda</p>
      <h2>{{ d.unpaidStudents }}</h2>
      <small>Seguimiento pendiente</small>
    </article>

    <article class="kpi-card wide">
      <div class="kpi-head">
        <mat-icon class="icon royal">payments</mat-icon>
        <span class="badge positive">+$12K</span>
      </div>
      <p class="label">Recaudación</p>
      <h2>{{ d.totalIncome | currency:'$':'symbol':'1.0-0' }}</h2>
      <div class="mini-chart">
        <span class="dot"></span>
        <span class="line"></span>
        <span class="dot"></span>
        <span class="line"></span>
        <span class="dot"></span>
      </div>
      <small>Últimos 30 días</small>
    </article>

    <article class="kpi-card wide">
      <div class="kpi-head">
        <mat-icon class="icon accent">equalizer</mat-icon>
        <span class="badge neutral">estable</span>
      </div>
      <p class="label">Ticket promedio</p>
      <h2>
        {{
          ticketAverage !== null
            ? (ticketAverage | currency:'$':'symbol':'1.0-0')
            : '—'
        }}
      </h2>
      <small>Promedio por alumno</small>
      <div class="progress">
        <div class="progress-bar" [style.width.%]="ticketAverage ? 75 : 15"></div>
      </div>
    </article>
  </section>

  <section class="quick-list">
    <article class="quick-card">
      <div>
        <p class="label">Acciones sugeridas</p>
        <h4>Clientes que adeudan</h4>
        <p class="muted">Contactá a los alumnos pendientes antes del cierre.</p>
      </div>
<button
  type="button"
  routerLink="/dashboard/morosos">
  Ver lista
</button>
    </article>

    <article class="quick-card">
      <div>
        <p class="label">Reporte rápido</p>
        <h4>Descargar resumen mensual</h4>
        <p class="muted">Ideal para compartir con tu equipo.</p>
      </div>
      <button
        type="button"
        (click)="downloadMonthlyReport()"
        [disabled]="isDownloading">
        {{ isDownloading ? 'Generando...' : 'Descargar' }}
      </button>
    </article>

    <article class="quick-card">
      <div>
        <p class="label">Reporte diario</p>
        <h4>Asistencia del día</h4>
        <p class="muted">Imprimí la asistencia de todas las clases del día.</p>
        <mat-form-field appearance="outline" class="report-date">
          <mat-label>Fecha</mat-label>
          <input matInput [matDatepicker]="picker" [(ngModel)]="reportDate" />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
      <button
        type="button"
        (click)="downloadDailyReport()"
        [disabled]="isDownloadingDaily">
        {{ isDownloadingDaily ? 'Generando...' : 'Imprimir' }}
      </button>
    </article>
  </section>

  </ng-container>
</div>

<ng-template #freePlanNotice>
  <div class="admin-dashboard">
    <section class="quick-list">
      <article class="quick-card">
        <div>
          <p class="label">Plan FREE</p>
          <h4>Función disponible en planes avanzados</h4>
          <p class="muted">El dashboard y los reportes están habilitados solo en plan PRO.</p>
        </div>
      </article>
    </section>
  </div>
</ng-template>
