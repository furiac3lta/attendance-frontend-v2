<mat-card class="attendance-view-card">

  <h1 class="title"> Asistencia - {{ courseName }}</h1>
  <h2>{{ titleLabel }}</h2>
  <p class="taken-by" *ngIf="takenByName">
    Tomada por {{ takenByName }} ({{ takenByRole }})
  </p>



  <mat-divider></mat-divider>

  <div *ngIf="loading" class="loading">
    Cargando asistencia…
  </div>

  <div class="attendance-cards" *ngIf="!loading && records.length > 0">
    <article class="attendance-card" *ngFor="let r of records">
      <div class="card-head">
        <div>
          <div class="card-title">{{ r.fullName }}</div>
          <div class="card-subtitle">
            <span *ngIf="r.takenAt; else noDateCard">
              {{ r.takenAt | date:'dd/MM/yyyy HH:mm' }}
            </span>
            <ng-template #noDateCard>
              <span class="text-muted">—</span>
            </ng-template>
          </div>
        </div>
        <div class="card-status">
          <mat-icon
            [ngClass]="r.present ? 'paid-ok' : 'paid-bad'">
            {{ r.present ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </div>
      </div>

      <div class="card-grid">
        <div class="card-row" *ngIf="proPlan">
          <span class="label">Cuota</span>
          <span class="value">
            <mat-icon
              [ngClass]="r.paid ? 'paid-ok' : 'paid-bad'">
              {{ r.paid ? 'check_circle' : 'cancel' }}
            </mat-icon>
          </span>
        </div>
        <div class="card-row">
          <span class="label">Presente</span>
          <span class="value">
            {{ r.present ? 'Presente' : 'Ausente' }}
          </span>
        </div>
      </div>
    </article>
  </div>

  <div class="table-wrapper" *ngIf="!loading && records.length > 0">
    <table
      mat-table
      [dataSource]="records"
      class="table-modern">

      <!-- ===================== -->
      <!-- Alumno                -->
      <!-- ===================== -->
      <ng-container matColumnDef="fullName">
        <th mat-header-cell *matHeaderCellDef> Alumno </th>
        <td mat-cell *matCellDef="let r">
          {{ r.fullName }}
        </td>
      </ng-container>

      <!-- ===================== -->
      <!-- Estado de pago        -->
      <!-- ===================== -->
      <ng-container matColumnDef="paid" *ngIf="proPlan">
        <th mat-header-cell *matHeaderCellDef> Cuota </th>
        <td mat-cell *matCellDef="let r">
          <mat-icon
            [ngClass]="r.paid ? 'paid-ok' : 'paid-bad'"
            matTooltip="{{ r.paid ? 'Cuota al día' : 'Cuota vencida' }}">
            {{ r.paid ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </td>
      </ng-container>

      <!-- ===================== -->
      <!-- Presente              -->
      <!-- ===================== -->
      <ng-container matColumnDef="present">
        <th mat-header-cell *matHeaderCellDef> Presente </th>
        <td mat-cell *matCellDef="let r">
          <mat-icon
            [ngClass]="r.present ? 'paid-ok' : 'paid-bad'">
            {{ r.present ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </td>
      </ng-container>

      <!-- ===================== -->
      <!-- Fecha                 -->
      <!-- ===================== -->
      <ng-container matColumnDef="takenAt">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let r">
          <span *ngIf="r.takenAt; else noDate">
            {{ r.takenAt | date:'dd/MM/yyyy HH:mm' }}
          </span>
          <ng-template #noDate>
            <span class="text-muted">—</span>
          </ng-template>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </div>

  <div *ngIf="!loading && records.length === 0" class="empty">
    No hay asistencias registradas.
  </div>

  <div class="actions">
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon> Volver
    </button>
  </div>

</mat-card>
